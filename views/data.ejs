<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head.ejs') %>

    <body>
        <%- include('./partials/nav.ejs') %>

            <!-- <canvas id="myChart" width="400" height="100"></canvas> -->

            <!-- <div class="graph-container">
                <div class="graph-item">
                    <canvas onresize="change()" id="myChart" width="400" height="100"></canvas>
                </div>
                <div class="graph-item">
                    <p>Hello This is a graph of globalTemps</p>
                    <!-- <h5>Lorem ipsum dolor sit amet consectetur adipisicing elit. Porro recusandae magnam at aperiam? Eligendi inventore nobis itaque ipsum beatae cumque explicabo ratione nulla molestiae repellat. Ipsum fuga nemo odio molestiae.</h5> -->
            <!-- <canvas id="myChart" width="400" height="100"></canvas> -->
            <!-- </div>
                <div class="graph-item">
                    3
                    <!-- <canvas id="myChart" width="400" height="100"></canvas> -->
            <!-- </div> -->
            <!-- <div class="graph-item"> -->
            <!-- 4 -->
            <!-- <canvas id="myChart" width="400" height="100"></canvas> -->
            <!-- </div> -->
            <!-- </div>  -->



            <div class="graph-container">
                <h2>COVID cases INDIA</h2>
                <div class="graph-item" style="position: relative; height:50vh; width:40vw">
                    <canvas id="myChart"></canvas>
                </div>            
                <div class="graph-item" style="position: relative; height:50vh; width:40vw">
                    3
                </div>
                <h2>Hello There</h2>
                <div class="graph-item">
                    4
                </div>
            </div>

            <%- include('./partials/footer.ejs') %>

    </body>


    <script>
        // Data from: https://data.giss.nasa.gov/gistemp/
        // Mean from: https://earthobservatory.nasa.gov/world-of-change/DecadalTemp

        // chart.canvas.parentNode.style.height = '128px';
        // chart.canvas.parentNode.style.width = '128px';

        // window.addEventListener('beforeprint', () => {
        //     myChart.resize(600, 600);
        // });
        // window.addEventListener('afterprint', () => {
        //     myChart.resize();
        // });
        
        document.getElementsByClassName("graph-container").width = screen.width;
        window.addEventListener('load', setup);
        // var canvas = document.getElementById('myChart');
        // var context = canvas.getContext('2d');
        // context.clearRect(0, 0, canvas.width, canvas.height);

        async function setup() {
            const ctx = document.getElementById('myChart').getContext('2d');
            const CovCaseIN = await getData();
            const myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: CovCaseIN.days,
                    datasets: [
                        {
                            label: 'COVID cases INDIA',
                            data: CovCaseIN.cases,
                             fill: 1 ,
                            // borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.5)',
                            borderWidth: 1
                        },
                        {
                            label: 'COVID recovered INDIA',
                            data: CovCaseIN.recovered,
                            fill: 2,
                            // borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(60, 179, 113, 0.5)',
                            borderWidth: 1
                        },
                        {
                            label: 'COVID deceased INDIA',
                            data: CovCaseIN.deceased,
                            fill: true,
                            // borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(0, 0,255, 0.5)',
                            borderWidth: 1
                        },
                    ]
                },
                options: {
                    maintainAspectRatio: false,
                }
            });
        }

        async function getData() {
            // const response = await fetch('testdata.csv');
            const response = await fetch('https://api.covid19india.org/csv/latest/case_time_series.csv');
            const data = await response.text();
            const days = [];
            const cases = [];
            const recovered = [];
            const deceased = [];
            const rows = data.split('\n').slice(1);
            rows.forEach(row => {
                const cols = row.split(',');
                days.push(cols[1]);
                cases.push(cols[3]);
                recovered.push(cols[5]);
                deceased.push(cols[7]);
            });
            return { days, cases, recovered, deceased };
        }
    </script>

</html>